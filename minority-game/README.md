# ğŸ¯ Minority Wins - å°‘æ•°æ´¾è·èƒœæŠ•ç¥¨æ¸¸æˆ

ä¸€ä¸ªåŸºäºä»¥å¤ªåŠ/BSCçš„é“¾ä¸ŠæŠ•ç¥¨æ¸¸æˆï¼Œé‡‡ç”¨"å°‘æ•°æ´¾è·èƒœ"çš„ç‹¬ç‰¹æœºåˆ¶ã€‚ç”¨æˆ·å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰æŠ•ç¥¨é—®é¢˜ï¼Œå…¶ä»–ç”¨æˆ·å‚ä¸æŠ•ç¥¨ï¼Œè·å¾—æœ€å°‘æŠ•ç¥¨çš„é€‰é¡¹ï¼ˆå°‘æ•°æ´¾ï¼‰å°†è·èƒœå¹¶åˆ†äº«å¤±è´¥è€…çš„æŠ•æ³¨ã€‚

## âœ¨ ç‰¹æ€§

- ğŸ—³ï¸ **è‡ªå®šä¹‰æŠ•ç¥¨**: ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥åˆ›å»ºå¸¦æœ‰è‡ªå®šä¹‰é—®é¢˜å’Œé€‰é¡¹çš„æŠ•ç¥¨ï¼ˆ2-10ä¸ªé€‰é¡¹ï¼‰
- ğŸ² **å°‘æ•°æ´¾è·èƒœ**: è·å¾—æœ€å°‘æŠ•ç¥¨çš„é€‰é¡¹è·èƒœï¼Œå®ç°åšå¼ˆè®ºæœºåˆ¶
- ğŸ”’ **Commit-Revealæœºåˆ¶**: é˜²æ­¢æŠ¢å…ˆäº¤æ˜“å’Œæ“çºµæŠ•ç¥¨
- ğŸ’° **æŠ¼é‡‘æœºåˆ¶**: éœ€è¦æ”¯ä»˜30-70%çš„æŠ¼é‡‘æ¥é˜²æ­¢ä½œå¼Š
- ğŸ† **å¥–åŠ±åˆ†é…**: è·èƒœè€…æŒ‰æ¯”ä¾‹åˆ†äº«å¤±è´¥è€…çš„æŠ•æ³¨
- ğŸ¨ **ç°ä»£åŒ–UI**: ç¾è§‚çš„æ¸å˜è‰²ç•Œé¢ï¼Œæµç•…çš„åŠ¨ç”»æ•ˆæœ
- ğŸ” **å®‰å…¨æ€§**: åŸºäºOpenZeppelinçš„å®‰å…¨åˆçº¦åº“

## ğŸ® æ¸¸æˆè§„åˆ™

1. **åˆ›å»ºæŠ•ç¥¨**: ç”¨æˆ·æå‡ºé—®é¢˜å¹¶è®¾ç½®2-10ä¸ªé€‰é¡¹
2. **æäº¤é˜¶æ®µ** (1å°æ—¶):
   - ç©å®¶é€‰æ‹©é€‰é¡¹å¹¶æäº¤åŠ å¯†çš„commit
   - éœ€è¦æ”¯ä»˜æŠ¼é‡‘ï¼ˆæŠ•æ³¨é‡‘é¢çš„30-70%ï¼‰
3. **æ­ç¤ºé˜¶æ®µ** (30åˆ†é’Ÿ):
   - ç©å®¶æ­ç¤ºä»–ä»¬çš„é€‰æ‹©
   - æœªæ­ç¤ºçš„ç©å®¶å°†å¤±å»æŠ¼é‡‘
4. **ç»“ç®—é˜¶æ®µ**:
   - è®¡ç®—æ¯ä¸ªé€‰é¡¹çš„æ€»æŠ•æ³¨
   - æŠ•æ³¨æœ€å°‘çš„é€‰é¡¹è·èƒœï¼ˆå°‘æ•°æ´¾ï¼‰
   - è·èƒœè€…æŒ‰æ¯”ä¾‹åˆ†äº«å¤±è´¥è€…çš„æŠ•æ³¨
5. **é¢†å¥–é˜¶æ®µ**:
   - è·èƒœè€…å¯ä»¥é¢†å–å¥–åŠ±

## ğŸ“ é¡¹ç›®ç»“æ„

```
minority-game/
â”œâ”€â”€ contracts/
â”‚   â”œâ”€â”€ VotingGame.sol          # ä¸»åˆçº¦
â”‚   â””â”€â”€ minority2.sol           # æ—§ç‰ˆåˆçº¦ï¼ˆä¿ç•™ï¼‰
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ voting.html             # æ–°ç‰ˆå‰ç«¯ç•Œé¢
â”‚   â”œâ”€â”€ voting.js               # æ–°ç‰ˆå‰ç«¯é€»è¾‘
â”‚   â”œâ”€â”€ index.html              # æ—§ç‰ˆç•Œé¢ï¼ˆä¿ç•™ï¼‰
â”‚   â””â”€â”€ app.js                  # æ—§ç‰ˆé€»è¾‘ï¼ˆä¿ç•™ï¼‰
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ deploy.js               # éƒ¨ç½²è„šæœ¬
â”‚   â”œâ”€â”€ verify.js               # éªŒè¯è„šæœ¬
â”‚   â””â”€â”€ interact.js             # äº¤äº’è„šæœ¬
â”œâ”€â”€ test/
â”‚   â””â”€â”€ VotingGame.test.js      # æµ‹è¯•ç”¨ä¾‹
â”œâ”€â”€ hardhat.config.js           # Hardhaté…ç½®
â”œâ”€â”€ package.json
â””â”€â”€ README.md
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- Node.js >= 16
- npm æˆ– yarn
- MetaMask æµè§ˆå™¨æ‰©å±•

### å®‰è£…ä¾èµ–

```bash
cd minority-game
npm install
```

### é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ `.env.example` ä¸º `.env` å¹¶å¡«å…¥é…ç½®ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼š

```
PRIVATE_KEY=ä½ çš„ç§é’¥
BSC_TESTNET_URL=https://data-seed-prebsc-1-s1.binance.org:8545
BSCSCAN_API_KEY=ä½ çš„BSCScan APIå¯†é’¥
```

### ç¼–è¯‘åˆçº¦

```bash
npx hardhat compile
```

### è¿è¡Œæµ‹è¯•

```bash
npx hardhat test
```

æµ‹è¯•è¦†ç›–ï¼š
- âœ… åˆ›å»ºæŠ•ç¥¨åŠŸèƒ½
- âœ… æäº¤commitåŠŸèƒ½
- âœ… æ­ç¤ºæŠ•ç¥¨åŠŸèƒ½
- âœ… ç»“ç®—å’Œå¥–åŠ±è®¡ç®—
- âœ… é¢†å–å¥–åŠ±åŠŸèƒ½
- âœ… è¾¹ç•Œæ¡ä»¶æµ‹è¯•

### éƒ¨ç½²åˆçº¦

#### æœ¬åœ°æµ‹è¯•ç½‘

```bash
npx hardhat node
# åœ¨å¦ä¸€ä¸ªç»ˆç«¯
npx hardhat run scripts/deploy.js --network localhost
```

#### BSC æµ‹è¯•ç½‘

```bash
npx hardhat run scripts/deploy.js --network bscTestnet
```

#### BSC ä¸»ç½‘

```bash
npx hardhat run scripts/deploy.js --network bscMainnet
```

### éªŒè¯åˆçº¦

```bash
npx hardhat run scripts/verify.js --network bscTestnet
```

### ä¸åˆçº¦äº¤äº’

```bash
npx hardhat run scripts/interact.js --network bscTestnet
```

## ğŸŒ ä½¿ç”¨å‰ç«¯

### é…ç½®åˆçº¦åœ°å€

1. éƒ¨ç½²åˆçº¦åï¼Œå°†åˆçº¦åœ°å€å¤åˆ¶åˆ° `frontend/voting.js`ï¼š

```javascript
const CONTRACT_ADDRESS = "ä½ çš„åˆçº¦åœ°å€";
```

2. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `frontend/voting.html`

### ä½¿ç”¨æ­¥éª¤

1. **è¿æ¥é’±åŒ…**: ç‚¹å‡»"è¿æ¥ MetaMask"æŒ‰é’®
2. **åˆ›å»ºæŠ•ç¥¨**:
   - è¾“å…¥æŠ•ç¥¨é—®é¢˜
   - æ·»åŠ é€‰é¡¹ï¼ˆ2-10ä¸ªï¼‰
   - ç‚¹å‡»"åˆ›å»ºæŠ•ç¥¨"
3. **å‚ä¸æŠ•ç¥¨**:
   - åˆ‡æ¢åˆ°"å‚ä¸æŠ•ç¥¨"æ ‡ç­¾
   - é€‰æ‹©ä¸€ä¸ªæ´»è·ƒçš„æŠ•ç¥¨
   - é€‰æ‹©ä½ çš„ç­”æ¡ˆå¹¶è¾“å…¥æŠ•æ³¨é‡‘é¢
   - æäº¤commit
4. **æ­ç¤ºæŠ•ç¥¨**:
   - åœ¨æ­ç¤ºé˜¶æ®µï¼Œæäº¤reveal
5. **é¢†å–å¥–åŠ±**:
   - åœ¨"æˆ‘çš„æŠ•ç¥¨"æ ‡ç­¾æŸ¥çœ‹ç»“æœ
   - å¦‚æœè·èƒœï¼Œç‚¹å‡»"é¢†å–å¥–åŠ±"

## ğŸ§ª æµ‹è¯•ç”¨ä¾‹è¯´æ˜

### åˆ›å»ºæŠ•ç¥¨æµ‹è¯•
- éªŒè¯æ­£å¸¸åˆ›å»ºæŠ•ç¥¨
- éªŒè¯é€‰é¡¹æ•°é‡é™åˆ¶ï¼ˆ2-10ä¸ªï¼‰
- éªŒè¯é—®é¢˜å’Œé€‰é¡¹ä¸èƒ½ä¸ºç©º

### Commité˜¶æ®µæµ‹è¯•
- éªŒè¯æ­£å¸¸æäº¤commit
- éªŒè¯å¿…é¡»æ”¯ä»˜æŠ¼é‡‘
- éªŒè¯ä¸èƒ½é‡å¤commit
- éªŒè¯æ—¶é—´é™åˆ¶

### Revealé˜¶æ®µæµ‹è¯•
- éªŒè¯æ­£å¸¸æ­ç¤ºæŠ•ç¥¨
- éªŒè¯å“ˆå¸ŒåŒ¹é…
- éªŒè¯æŠ¼é‡‘é‡‘é¢èŒƒå›´ï¼ˆ30-70%ï¼‰
- éªŒè¯æ—¶é—´é™åˆ¶

### ç»“ç®—æµ‹è¯•
- éªŒè¯å°‘æ•°æ´¾æ­£ç¡®è¯†åˆ«
- éªŒè¯å¥–åŠ±è®¡ç®—å‡†ç¡®
- éªŒè¯è·èƒœè€…å¯ä»¥é¢†å–å¥–åŠ±
- éªŒè¯å¤±è´¥è€…æ²¡æœ‰å¥–åŠ±
- éªŒè¯æœªæ­ç¤ºè€…å¤±å»æŠ¼é‡‘

### æŸ¥è¯¢åŠŸèƒ½æµ‹è¯•
- éªŒè¯è·å–æ´»è·ƒæŠ•ç¥¨
- éªŒè¯è·å–å‚ä¸è€…åˆ—è¡¨

## ğŸ“Š æ™ºèƒ½åˆçº¦ API

### ä¸»è¦å‡½æ•°

#### createVote
åˆ›å»ºæ–°æŠ•ç¥¨
```solidity
function createVote(string memory question, string[] memory options)
    external returns (uint256)
```

#### commit
æäº¤åŠ å¯†çš„æŠ•ç¥¨commit
```solidity
function commit(uint256 voteId, bytes32 commitHash)
    external payable
```

#### reveal
æ­ç¤ºæŠ•ç¥¨é€‰æ‹©
```solidity
function reveal(uint256 voteId, uint256 choice, uint256 betAmount, bytes32 secret)
    external
```

#### finalizeVote
ç»“ç®—æŠ•ç¥¨
```solidity
function finalizeVote(uint256 voteId)
    external
```

#### claimReward
é¢†å–å¥–åŠ±
```solidity
function claimReward(uint256 voteId)
    external
```

### æŸ¥è¯¢å‡½æ•°

#### getVoteInfo
è·å–æŠ•ç¥¨ä¿¡æ¯
```solidity
function getVoteInfo(uint256 voteId)
    external view returns (...)
```

#### calculateReward
è®¡ç®—ç©å®¶å¥–åŠ±
```solidity
function calculateReward(uint256 voteId, address player)
    external view returns (uint256)
```

#### getAllActiveVotes
è·å–æ‰€æœ‰æ´»è·ƒæŠ•ç¥¨
```solidity
function getAllActiveVotes()
    external view returns (uint256[] memory)
```

## ğŸ” å®‰å…¨ç‰¹æ€§

1. **ReentrancyGuard**: é˜²æ­¢é‡å…¥æ”»å‡»
2. **Commit-Reveal**: é˜²æ­¢æŠ¢å…ˆäº¤æ˜“
3. **æŠ¼é‡‘æœºåˆ¶**: é˜²æ­¢æ¶æ„æäº¤
4. **æ—¶é—´é”**: ç¡®ä¿æ¸¸æˆå…¬å¹³æ€§
5. **è¾“å…¥éªŒè¯**: ä¸¥æ ¼çš„å‚æ•°æ£€æŸ¥

## ğŸ¨ å‰ç«¯ç‰¹æ€§

- ğŸ“± å“åº”å¼è®¾è®¡ï¼Œæ”¯æŒç§»åŠ¨ç«¯
- ğŸ­ æµç•…çš„åŠ¨ç”»æ•ˆæœ
- ğŸ¨ ç°ä»£åŒ–æ¸å˜è‰²UI
- ğŸ’¾ æœ¬åœ°å­˜å‚¨commitä¿¡æ¯
- ğŸ”„ å®æ—¶çŠ¶æ€æ›´æ–°
- âš¡ å¿«é€Ÿçš„äº¤äº’ä½“éªŒ

## ğŸ“ å¼€å‘ç¬”è®°

### Commit Hash è®¡ç®—

```javascript
const commitHash = ethers.keccak256(
    ethers.solidityPacked(
        ['uint256', 'uint256', 'uint256', 'bytes32', 'address'],
        [voteId, choice, betAmount, secret, userAddress]
    )
);
```

### æŠ¼é‡‘è®¡ç®—

æŠ¼é‡‘ä¸ºæŠ•æ³¨é‡‘é¢çš„30-70%ï¼š
```javascript
const randomPercent = Math.floor(Math.random() * 41) + 30;
const deposit = betAmount * randomPercent / 100;
```

### å¥–åŠ±è®¡ç®—

è·èƒœè€…å¥–åŠ± = æŠ•æ³¨ + æŠ¼é‡‘ + (å¤±è´¥è€…æ€»æŠ•æ³¨ Ã— ä¸ªäººæŠ•æ³¨ / è·èƒœè€…æ€»æŠ•æ³¨)

```solidity
uint256 share = (losingTotal * playerCommit.betAmount) / winningTotal;
return playerCommit.betAmount + playerCommit.depositAmount + share;
```

## ğŸ› å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆéœ€è¦æŠ¼é‡‘ï¼Ÿ
A: æŠ¼é‡‘æœºåˆ¶é˜²æ­¢ç”¨æˆ·æäº¤commitåä¸æ­ç¤ºï¼Œç¡®ä¿æ¸¸æˆå…¬å¹³æ€§ã€‚

### Q: å¦‚æœæ‰€æœ‰é€‰é¡¹å¾—ç¥¨ç›¸åŒæ€ä¹ˆåŠï¼Ÿ
A: ç³»ç»Ÿå°†è¯†åˆ«ä¸ºå¹³å±€ï¼Œæ‰€æœ‰ç©å®¶å–å›æŠ•æ³¨å’ŒæŠ¼é‡‘ã€‚

### Q: æ­ç¤ºé˜¶æ®µé”™è¿‡äº†æ€ä¹ˆåŠï¼Ÿ
A: é”™è¿‡æ­ç¤ºé˜¶æ®µå°†å¤±å»æŠ¼é‡‘ï¼Œè¿™æ˜¯ä¸ºäº†æƒ©ç½šä¸è¯šå®çš„è¡Œä¸ºã€‚

### Q: å¯ä»¥åˆ›å»ºå¤šå°‘ä¸ªé€‰é¡¹ï¼Ÿ
A: æœ€å°‘2ä¸ªï¼Œæœ€å¤š10ä¸ªé€‰é¡¹ã€‚

## ğŸ“œ è®¸å¯è¯

MIT License

## ğŸ‘¥ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š
- æäº¤ GitHub Issue
- å‘é€é‚®ä»¶è‡³é¡¹ç›®ç»´æŠ¤è€…

---

**æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªå®éªŒæ€§é¡¹ç›®ï¼Œè¯·åœ¨æµ‹è¯•ç½‘ä¸Šå……åˆ†æµ‹è¯•åå†éƒ¨ç½²åˆ°ä¸»ç½‘ã€‚æŠ•èµ„æœ‰é£é™©ï¼Œå‚ä¸éœ€è°¨æ…ï¼
