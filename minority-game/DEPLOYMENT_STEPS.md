# æœ¬åœ°éƒ¨ç½²æ–°åˆçº¦æ­¥éª¤

## å‰ææ¡ä»¶
ç¡®ä¿ä½ çš„Macä¸Šå·²ç»å®‰è£…äº†ï¼š
- Node.js (v16æˆ–æ›´é«˜)
- Git

## æ­¥éª¤1: æ‹‰å–æœ€æ–°ä»£ç 

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/dapp

# æ‹‰å–æœ€æ–°ä»£ç 
git pull origin claude/fix-commit-phase-timing-01GaoxNHg1h5inFwffdq9wzJ

# æˆ–è€…ç›´æ¥åœ¨å½“å‰åˆ†æ”¯åˆå¹¶
git merge claude/fix-commit-phase-timing-01GaoxNHg1h5inFwffdq9wzJ
```

## æ­¥éª¤2: å®‰è£…ä¾èµ–

```bash
cd minority-game
npm install
```

## æ­¥éª¤3: ç¼–è¯‘åˆçº¦

```bash
npx hardhat compile
```

ä½ åº”è¯¥çœ‹åˆ°ï¼š
```
Compiled 1 Solidity file successfully
```

## æ­¥éª¤4: å¯åŠ¨æœ¬åœ°æµ‹è¯•ç½‘ç»œ

**æ‰“å¼€ç¬¬ä¸€ä¸ªç»ˆç«¯çª—å£**ï¼Œè¿è¡Œï¼š

```bash
npx hardhat node
```

ä¿æŒè¿™ä¸ªç»ˆç«¯è¿è¡Œï¼Œä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š
```
Started HTTP and WebSocket JSON-RPC server at http://127.0.0.1:8545/

Accounts
========
Account #0: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 (10000 ETH)
Account #1: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8 (10000 ETH)
...
```

## æ­¥éª¤5: éƒ¨ç½²åˆçº¦

**æ‰“å¼€ç¬¬äºŒä¸ªç»ˆç«¯çª—å£**ï¼Œåœ¨åŒä¸€ç›®å½•ä¸‹è¿è¡Œï¼š

```bash
npx hardhat run scripts/deploy-alt-address.js --network localhost
```

ä½ ä¼šçœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š
```
ğŸš€ ä½¿ç”¨å¤‡ç”¨è´¦æˆ·éƒ¨ç½² VotingGame åˆçº¦ï¼ˆé¿å¼€MetaMaskè­¦å‘Šï¼‰...

âœ… éƒ¨ç½²è´¦æˆ·ï¼ˆè´¦æˆ·#1ï¼‰: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8
ğŸ’° è´¦æˆ·ä½™é¢: 10000.0 ETH

ğŸ“ æ­£åœ¨éƒ¨ç½²åˆçº¦...

ğŸ‰ VotingGame åˆçº¦å·²éƒ¨ç½²!
ğŸ“ åˆçº¦åœ°å€: 0x8464135c8F25Da09e49BC8782676a84730C318bC
```

**é‡è¦**: è®°ä¸‹æ–°çš„åˆçº¦åœ°å€ï¼

## æ­¥éª¤6: æ›´æ–°å‰ç«¯é…ç½®

è„šæœ¬ä¼šè‡ªåŠ¨æ›´æ–° `frontend/voting.js`ï¼Œä½†ä½ è¿˜éœ€è¦æ‰‹åŠ¨æ›´æ–° `frontend/voting-improved.js`ï¼š

æ‰“å¼€ `minority-game/frontend/voting-improved.js`ï¼Œå°†ç¬¬2è¡Œçš„åœ°å€æ”¹ä¸ºæ–°éƒ¨ç½²çš„åˆçº¦åœ°å€ï¼š

```javascript
const CONTRACT_ADDRESS = "æ–°éƒ¨ç½²çš„åˆçº¦åœ°å€"; // æ›¿æ¢è¿™é‡Œ
```

## æ­¥éª¤7: é…ç½®MetaMask

1. æ‰“å¼€MetaMaskï¼Œåˆ‡æ¢ç½‘ç»œåˆ° **Localhost 8545**

2. å¦‚æœæ²¡æœ‰è¿™ä¸ªç½‘ç»œï¼Œæ‰‹åŠ¨æ·»åŠ ï¼š
   - ç½‘ç»œåç§°: Localhost 8545
   - RPC URL: `http://127.0.0.1:8545`
   - Chain ID: `1337`
   - è´§å¸ç¬¦å·: ETH

3. å¯¼å…¥æµ‹è¯•è´¦æˆ·ï¼ˆå¯é€‰ï¼Œç”¨äºæµ‹è¯•å¤šç”¨æˆ·åœºæ™¯ï¼‰ï¼š
   - ä»ç¬¬ä¸€ä¸ªç»ˆç«¯å¤åˆ¶Account #0æˆ–Account #1çš„ç§é’¥
   - åœ¨MetaMaskä¸­é€‰æ‹©"å¯¼å…¥è´¦æˆ·"
   - ç²˜è´´ç§é’¥

## æ­¥éª¤8: æµ‹è¯•æ–°åˆçº¦

1. æ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—®ï¼š`file:///path/to/minority-game/frontend/voting-improved.html`

2. è¿æ¥é’±åŒ…

3. åˆ›å»ºä¸€ä¸ªæµ‹è¯•æŠ•ç¥¨ï¼š
   - é—®é¢˜ï¼šTest Vote
   - Commitæ—¶é—´ï¼šè®¾ç½®ä¸º **5åˆ†é’Ÿ**ï¼ˆç”¨äºå¿«é€Ÿæµ‹è¯•ï¼‰
   - Revealæ—¶é—´ï¼š3åˆ†é’Ÿ
   - æ·»åŠ 2-3ä¸ªé€‰é¡¹

4. æäº¤commitå¹¶è§‚å¯Ÿï¼š
   - å€’è®¡æ—¶åº”è¯¥æ˜¾ç¤ºå‰©ä½™5åˆ†é’Ÿ
   - **å³ä½¿åˆ·æ–°é¡µé¢ï¼Œå€’è®¡æ—¶åº”è¯¥ä»ç„¶å‡†ç¡®**
   - åœ¨5åˆ†é’Ÿå†…ï¼Œcommité˜¶æ®µä¸åº”è¯¥ç»“æŸ
   - 5åˆ†é’Ÿåï¼Œè‡ªåŠ¨è¿›å…¥revealé˜¶æ®µ

5. æµ‹è¯•å¤šç”¨æˆ·åœºæ™¯ï¼ˆå¯é€‰ï¼‰ï¼š
   - åˆ‡æ¢MetaMaskè´¦æˆ·
   - å†æ¬¡è¿æ¥é’±åŒ…
   - å°è¯•å¯¹åŒä¸€ä¸ªæŠ•ç¥¨è¿›è¡Œcommit
   - éªŒè¯ä¸¤ä¸ªç”¨æˆ·çš„commitéƒ½æ­£å¸¸

## æ­¥éª¤9: éªŒè¯ä¿®å¤

åœ¨commité˜¶æ®µæœŸé—´ï¼š
- âœ… å³ä½¿åˆ·æ–°é¡µé¢ï¼Œå€’è®¡æ—¶åº”è¯¥ç»§ç»­å‡†ç¡®æ˜¾ç¤º
- âœ… ä¸åº”è¯¥å‡ºç°"End"çŠ¶æ€
- âœ… ä¸åº”è¯¥æå‰è¿›å…¥revealé˜¶æ®µ
- âœ… commitæ—¶é—´ç»“æŸåï¼Œè‡ªåŠ¨è¿›å…¥revealé˜¶æ®µ

## å¸¸è§é—®é¢˜

### Q1: ç¼–è¯‘å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
A: ç¡®ä¿hardhat.config.jså­˜åœ¨ã€‚å¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œå°è¯•åˆ é™¤node_moduleså’Œpackage-lock.jsonåé‡æ–°å®‰è£…ï¼š
```bash
rm -rf node_modules package-lock.json
npm install
npx hardhat compile
```

### Q2: MetaMaskæ˜¾ç¤º"å·²çŸ¥çš„å®‰å…¨é£é™©"è­¦å‘Š
A: è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬ä½¿ç”¨ `deploy-alt-address.js`ï¼ˆä½¿ç”¨Account #1éƒ¨ç½²ï¼‰ã€‚æ–°ç”Ÿæˆçš„åˆçº¦åœ°å€ä¸ä¼šè§¦å‘è¿™ä¸ªè­¦å‘Šã€‚

### Q3: å‰ç«¯æ˜¾ç¤º"Vote does not exist"
A: ç¡®ä¿ï¼š
1. MetaMaskè¿æ¥åˆ°æ­£ç¡®çš„ç½‘ç»œï¼ˆLocalhost 8545ï¼‰
2. å‰ç«¯é…ç½®çš„åˆçº¦åœ°å€æ­£ç¡®
3. æœ¬åœ°èŠ‚ç‚¹ï¼ˆç¬¬ä¸€ä¸ªç»ˆç«¯ï¼‰ä»åœ¨è¿è¡Œ

### Q4: äº¤æ˜“ä¸€ç›´pending
A: åœ¨MetaMaskä¸­é‡ç½®è´¦æˆ·ï¼š
1. è®¾ç½® â†’ é«˜çº§ â†’ æ¸…é™¤æ´»åŠ¨å’Œè´¦æˆ·nonceæ•°æ®
2. æˆ–è€…é‡å¯æœ¬åœ°èŠ‚ç‚¹ï¼ˆä¼šæ¸…é™¤æ‰€æœ‰æ•°æ®ï¼‰

## æ ¸å¿ƒæ”¹è¿›è¯´æ˜

æ–°åˆçº¦çš„æ ¸å¿ƒæ”¹è¿›ï¼š

```solidity
// 1. æ–°å¢è‡ªåŠ¨é˜¶æ®µæ›´æ–°å‡½æ•°
function _updateStage(uint256 voteId) internal {
    if (vote.stage == VoteStage.Committing && block.timestamp >= vote.commitEndTime) {
        vote.stage = VoteStage.Revealing;
    }
}

// 2. commitå’Œrevealå‡½æ•°åœ¨æ‰§è¡Œå‰å…ˆæ›´æ–°é˜¶æ®µ
function commit(...) {
    _updateStage(voteId);  // å…ˆæ£€æŸ¥å¹¶æ›´æ–°é˜¶æ®µ
    require(vote.stage == VoteStage.Committing, "Not in commit phase");
    // ...
}

// 3. æŸ¥è¯¢å‡½æ•°è¿”å›åŸºäºæ—¶é—´è®¡ç®—çš„å‡†ç¡®é˜¶æ®µ
function getVoteInfo(...) returns (VoteInfo memory) {
    return VoteInfo({
        stage: _getCurrentStage(voteId),  // åŠ¨æ€è®¡ç®—å½“å‰é˜¶æ®µ
        // ...
    });
}
```

è¿™ç¡®ä¿äº†ï¼š
- é˜¶æ®µè½¬æ¢å®Œå…¨åŸºäºåŒºå—æ—¶é—´
- ä»»ä½•äººéƒ½æ— æ³•æå‰æ‰‹åŠ¨ç»“æŸé˜¶æ®µ
- å‰ç«¯å§‹ç»ˆæ˜¾ç¤ºå‡†ç¡®çš„é˜¶æ®µçŠ¶æ€

## ä¸‹ä¸€æ­¥

å®Œæˆæµ‹è¯•åï¼Œå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ å¯ä»¥ï¼š
1. ç»§ç»­ä½¿ç”¨æœ¬åœ°ç½‘ç»œæµ‹è¯•
2. æˆ–éƒ¨ç½²åˆ°BSCæµ‹è¯•ç½‘ï¼ˆéœ€è¦é…ç½®.envæ–‡ä»¶ï¼‰
3. æˆ–éƒ¨ç½²åˆ°BSCä¸»ç½‘ï¼ˆéœ€è¦çœŸå®BNBï¼‰

æœ‰ä»»ä½•é—®é¢˜è¯·å‘Šè¯‰æˆ‘ï¼
